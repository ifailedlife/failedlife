---
import Default from '~/layouts/Default.astro'
import { getCollection } from 'astro:content'
import type { CollectionEntry } from 'astro:content'
import Post from '~/components/Post.astro'
import ListSection from '~/components/ListSection.astro'
import ListItem from '~/components/ListItem.astro'

type Post = CollectionEntry<'posts'>

const allPosts = await getCollection('posts')

const postByYear = new Map<number, Post[]>()
allPosts.forEach((post: Post) => {
  const year = new Date(post.data.pubDate).getFullYear()
  if (!postByYear.has(year)) {
    postByYear.set(year, [])
  }
  postByYear.get(year)!.push(post)
})
---

<Default>
  {
    Array.from(postByYear.entries()).map(([year, posts]) => (
      <ListSection title={year}>
        {posts.map((post) => (
          <ListItem title={post.data.title} href={`/posts/${post.slug}/`} description={post.data.pubDate.toString().slice(0, 10)} />
        ))}
      </ListSection>
    ))
  }
</Default>
