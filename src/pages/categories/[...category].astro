---
import LayoutDefault from '~/layouts/LayoutDefault.astro'
import ListSection from '~/components/ListSection.astro'

import { getCategories } from '~/utils/index'
import ListItem from '~/components/ListItem.astro'

export async function getStaticPaths() {
  const categories = await getCategories()
  return Array.from(categories).map(([key, value]) => {
    return {
      params: { category: key },
      props: { posts: value },
    }
  })
}

const { posts } = Astro.props
const { category } = Astro.params
const { locale } = Astro.locals.config
---

<LayoutDefault>
  <ListSection title={category}>
    {posts.map((post) => <ListItem title={post.data.title} href={`/posts/${post.slug}/`} description={post.data.pubDate.toLocaleDateString(locale)} />)}
  </ListSection>
</LayoutDefault>
